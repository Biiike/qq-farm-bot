# qq-farm-bot 快速部署与使用文档

## 1. 已完成的部署

项目已部署到当前文件夹：`C:\Users\admin\Desktop\qqfarm`

已执行：

- `git clone https://github.com/linguo2625469/qq-farm-bot .`
- `npm install`
- `node client.js --decode`（启动参数解析与依赖校验通过）

## 2. 环境要求

- Node.js（建议 16+）
- Windows / macOS / Linux（本项目为 Node.js 命令行程序）

## 3. 首次使用

在项目根目录执行：

```bash
npm install
```

## 4. 启动方式

### 4.1 QQ 小程序（默认，二维码登录）

```bash
node client.js
```

### 4.2 QQ 小程序（使用已抓取 code）

```bash
node client.js --code <你的登录code>
```

### 4.3 微信小程序

```bash
node client.js --code <你的登录code> --wx
```

### 4.4 自定义巡查间隔

```bash
node client.js --code <code> --interval 5 --friend-interval 2
```

## 5. 常用参数

- `--code`：登录凭证 code
- `--wx`：切换为微信小程序模式（默认是 QQ）
- `--interval`：自己农场巡查间隔（秒）
- `--friend-interval`：好友农场巡查间隔（秒）
- `--verify`：验证 proto 定义
- `--decode`：进入 PB 解码工具模式

## 6. 微信邀请码（可选）

微信模式下可在根目录创建 `share.txt`，每行一个邀请参数：

```text
?uid=123&openid=xxx&share_source=4&doc_id=2
?uid=456&openid=xxx&share_source=4&doc_id=2
```

启动后会自动处理并清空该文件。

## 7. 关键配置

配置文件：`src/config.js`

重点项：

- `serverUrl`：网关地址
- `clientVersion`：客户端版本
- `heartbeatInterval`：心跳间隔
- `farmCheckInterval`：农场巡查循环等待
- `friendCheckInterval`：好友巡查循环等待
- `forceLowestLevelCrop`：是否强制最低等级作物

## 8. 故障排查

- 依赖安装失败：删除 `node_modules` 后重新 `npm install`
- 登录失败：更换有效 code 或改用 QQ 二维码登录
- 连接异常：检查网络与 `src/config.js` 中网关、版本配置

## 9. 风险提示

该项目属于自动化脚本，存在账号风控/封禁风险。请自行评估风险，低频、谨慎使用。

## 10. 网页运行面板（新增）

你可以在浏览器查看运行状态与关键指标，不需要一直盯着后台控制台。

### 10.1 本地启动

```bash
node client.js --dashboard --dashboard-port 3000 --code <你的登录code>
```

打开：`http://127.0.0.1:3000`

### 10.2 Zeabur 启动建议

Zeabur 通常会注入 `PORT` 环境变量，程序会自动在该端口启动网页面板。

推荐启动命令：

```bash
node client.js --code $QQ_CODE
```

如果平台自动识别为 `node index.js`（且你无法改 Start Command），本项目也已兼容：

- `index.js` 会自动读取环境变量并转发到 `client.js`
- 你只需要在 Zeabur 配置：`QQ_CODE=你的code`

可选环境变量：

- `DASHBOARD=1`（强制启用网页面板）
- `ENABLE_DASHBOARD=1`（同上）
- `FARM_INTERVAL=10`（可选，等价 `--interval 10`）
- `FRIEND_INTERVAL=2`（可选，等价 `--friend-interval 2`）
- `PLATFORM=wx` + `WX_CODE=xxx`（微信模式）

如果你没有传 `--dashboard`，但存在 `PORT`（Zeabur 场景），也会自动启用网页面板。

## 11. FarmCalc 整合（新增）

当前项目已整合 `FarmCalc` 页面与计算逻辑：

- 面板内可直接输入等级/地块并计算 Top 推荐
- 可一键将 Top1 推荐应用到机器人种植策略
- 也可打开完整 FarmCalc 页面

### 11.1 面板内使用

打开监控页后，在 `FarmCalc 整合计算器` 区域操作：

1. 输入 `等级`、`地块数`
2. 选择 `普通肥` 或 `不施肥` 模式
3. 点击 `计算推荐`
4. 点击 `应用Top1到机器人`

应用后，机器人会优先尝试该种子；若该种子当前商店不可买，会自动回退到自动策略。

### 11.2 完整 FarmCalc 页面

监控页里点击 `打开完整 FarmCalc 页面`，或直接访问：

- `http://127.0.0.1:3000/calc/`

### 11.3 策略说明

- `手动策略`：使用你在面板里应用的种子 ID
- `自动策略`：根据当前等级/地块动态计算推荐
- `回退策略`：当手动种子不可买或计算失败时，自动使用兜底逻辑
